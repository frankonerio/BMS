/*
 * BQ_common.h
 *
 *  Created on: Jul 28, 2024
 *      Author: frank
 */

#ifndef INC_BQ_COMMON_H_
#define INC_BQ_COMMON_H_

#include "stdbool.h"
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

extern uint8_t UV_Fault;             // under-voltage fault state
extern uint8_t OV_Fault;             // over-voltage fault state
extern uint8_t SCD_Fault;            // short-circuit fault state
extern uint8_t OCD_Fault;            // over-current fault state
extern uint8_t ProtectionsTriggered; // Set to 1 if any protection triggers

typedef enum
{
	BMS_STATE_OFF,      ///< Off state (charging and discharging disabled)
	BMS_STATE_CHG,      ///< Charging state (discharging disabled)
	BMS_STATE_DIS,      ///< Discharging state (charging disabled)
	BMS_STATE_NORMAL,   ///< Normal operating mode (both charging and discharging enabled)
	BMS_STATE_SHUTDOWN, ///< BMS starting shutdown sequence

} bms_state;

typedef struct
{
	bms_state bms_status;

	/** Manual enable/disable setting for charging */
	bool charge_enable;
	/** Manual enable/disable setting for discharging */
	bool discharge_enable;

	/** CV charging to cell_chg_voltage_limit finished */
	bool battery_full;
	/** Battery is discharged below cell_dis_voltage_limit */
	bool battery_empty;

	/** Calculated State of Charge (%) */
	float soc;

	/** Nominal capacity of battery pack (Ah) */
	float nominal_capacity_Ah;

	uint8_t bms_device;

}bms_context;

#endif /* INC_BQ_COMMON_H_ */
